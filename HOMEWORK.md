# Домашнее задание: Сравнение производительности различных подходов оптимизации

## Цель задания

Сравнить производительность различных подходов оптимизации инференса нейронных сетей:
- PyTorch (базовая версия)
- ONNX Runtime
- Torch-TensorRT

## Задачи

### 1. Обучение моделей для разных размеров изображений

Обучите модели ResNet-18 для размеров изображений:
- 224x224
- 256x256  
- 384x384
- 512x512

**Ожидаемый результат:** Модели сохранены в `./weights/best_resnet18_224.pth`, `./weights/best_resnet18_256.pth`, `./weights/best_resnet18_384.pth`

### 2. Тестирование моделей

Изучите влияние размера изображения и размера батча на скорость инференса в разных вариантах запуска моделей.

**ВНИМАНИЕ**: Добавьте в статистику время инференса на картинку (поделите время на размер батча, т.е. shape[0]) и изучите загруженность видеокарты. Если время при меньшем батче больше - значит ваша видеокарта недогружается. Исходя из этого определите оптимальный батч для вашего железа. В отчете приведите название видеокарты.

Дополнительное задание: добавьте в статистику профилирование tflops (числа операций, совершаемых при инференсе) и сравните его с теоретическим значением для вашей видеокарты или ЦП. Исходя из этого посчитайте загруженность вашего железа. Оптимальное значение - 95% и выше.

### 4. Анализ результатов

Проанализируйте результаты и ответьте на вопросы:

#### Вопросы для анализа:

1. **Какой подход показывает лучшую производительность?**
   - Сравните FPS для каждого подхода
   - Укажите ускорение относительно PyTorch

2. **Как размер изображения влияет на производительность?**
   - Постройте график FPS vs размер изображения
   - Определите оптимальный размер для вашего случая

3. **Как размер батча влияет на производительность?**
   - Постройте график FPS vs размер батча
   - Найдите точку насыщения (когда увеличение батча не дает прироста FPS)

## Метрики для сравнения

### Основные метрики:
- **Среднее время выполнения** (мс) - после отбрасывания 10% лучших и худших результатов
- **FPS** - кадров в секунду
- **Ускорение** - относительно базовой PyTorch модели
- **Стандартное отклонение** - стабильность производительности

### Дополнительные метрики (опционально):
- **Использование GPU памяти** (MB)
- **Использование CPU памяти** (MB)

## Структура отчета

### 1. Введение
- Описание задачи
- Методы оптимизации
- Ожидаемые результаты

### 2. Методология
- Описание экспериментальной установки
- Параметры тестирования
- Методы измерения

### 3. Результаты
- Таблицы с результатами бенчмарка
- Графики производительности
- Сравнительный анализ

### 4. Обсуждение
- Ответы на вопросы анализа
- Выводы о выборе оптимального подхода
- Рекомендации для production использования

### 5. Заключение
- Основные выводы
- Практические рекомендации
- Направления для дальнейшего исследования

## Примеры графиков

### График 1: FPS vs Размер изображения
```
FPS
  ^
  |    PyTorch
  |    ONNX
  |    Torch-TensorRT
  |    
  +-----------------> Размер изображения
```

### График 2: FPS vs Размер батча
```
FPS
  ^
  |    PyTorch
  |    ONNX
  |    Torch-TensorRT
  |    
  +-----------------> Размер батча
```

### График 3: Ускорение относительно PyTorch
```
Ускорение
  ^
  |    ONNX
  |    Torch-TensorRT
  |    
  +-----------------> Размер изображения/батча
```