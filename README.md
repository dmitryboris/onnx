# Урок 7: Оптимизация инференса и перенос моделей на другие платформы

## Описание урока

В этом уроке вы научитесь оптимизировать инференс нейросетей и переносить модели на разные платформы (ONNX, TensorRT, Torch-TensorRT) на примере ResNet-18 для классификации изображений (датасет из урока 5).

## Структура проекта

```
lesson7_onnx_and_trt_compilation/
├── requirements.txt
├── README.md
├── trainer.py                          # Оригинальный тренер для одного размера
├── core/
│   ├── model.py                       # Модель ResNet-18
│   ├── datasets.py                    # Датасет для загрузки изображений
│   ├── torch_onnx.py                  # Конвертация в ONNX
│   ├── torch_to_trt.py                # Конвертация в TensorRT
│   └── compare.py                     # Сравнение производительности
└── weights/                           # Папка для сохранения моделей
```

## Что вы изучите

1. **Обучение модели ResNet-18** для классификации изображений из урока 5
2. **Конвертация PyTorch модели в ONNX** формат с поддержкой динамических размеров
3. **Инференс ONNX моделей** на CPU и GPU
4. **Компиляция с помощью Torch-TensorRT** напрямую из PyTorch
5. **Конвертация ONNX в TensorRT** для максимальной оптимизации
6. **Сравнение производительности** всех подходов с отбрасыванием выбросов
7. **Анализ производительности** при разных размерах батча и изображений

## Требования

Код гарантировано выполняется из под WSL 2, некоторых дистрибутивов Linux (например, Ubuntu). Работа под Windows не гарантирована, поскольку требуется ручная сборка TRT.

- Python 3.8+
- CUDA 12+ (для GPU инференса)
- TensorRT 8+ (для TensorRT оптимизации)

**ВНИМАНИЕ**: ONNX можно запускать под Windows, но для работы CUDA установите CUDA-Toolkit и cuDNN.

## Установка зависимостей

```bash
pip install -r requirements.txt
```